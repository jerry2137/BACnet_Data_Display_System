<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" http-equiv="refresh" content=""/>
  <link type="text/css" rel="stylesheet" href="../static/style.css" />
  <script src="../static/jquery.min.js" type="text/javascript"></script>
 </head>
 <body>
  <main>
   <aside>
    <div class="seg flex_center display" id="system">
     <div>
      能源監控系統
      <br/>
      Energy Monitoring System
     </div>
     <img id="logo" src="../static/hkha_logo.jpg"/>
    </div>
    <div class="seg flex_center" id="building">
      珍蝶樓
      <br/>
      Chun Tip House
     </div>
    </div>
    <div class="seg flex_center" id="time">
    </div>
   </aside>
   <article>
    <section class="full display" id="tables">
      <div class="full">
        <table class="dataframe" id="table_1">
         <thead>
          <tr>
           <th colspan="3">
            Energy
           </th>
          </tr>
         </thead>
         <tbody>
          <tr>
           <td>
            平均能量
            <br/>
            Avg. Energy
           </td>
           <td>
            -0.7
           </td>
           <td>
            kWh/flat
           </td>
          </tr>
          <tr>
           <td>
            去年平均能量
            <br/>
            Last Year Avg. Energy
           </td>
           <td>
            25.0
           </td>
           <td>
            kWh/flat
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
         </tbody>
        </table>
       </div>
       <div class="full">
        <table class="dataframe" id="table_2">
         <thead>
          <tr>
           <th colspan="3">
            Gas
           </th>
          </tr>
         </thead>
         <tbody>
          <tr>
           <td>
            瓦斯用量
            <br/>
            Gas
           </td>
           <td>
            25.0
           </td>
           <td>
            MJ/flat
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
         </tbody>
        </table>
       </div>
       <div class="full">
        <table class="dataframe" id="table_3">
         <thead>
          <tr>
           <th colspan="3">
            Water
           </th>
          </tr>
         </thead>
         <tbody>
          <tr>
           <td>
            水量
            <br/>
            Water
           </td>
           <td>
            25.0
           </td>
           <td>
            m3/flat
           </td>
          </tr>
          <tr>
           <td>
            去年水量
            <br/>
            Last Year Water
           </td>
           <td>
            0.0
           </td>
           <td>
            m3/flat
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
          <tr>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
           <td id="hide">
            \
            <br/>
            \
           </td>
          </tr>
         </tbody>
        </table>
       </div>
    </section>
    <section class="display">
      <video autoplay="" muted="" src="../static/sample.mp4"></video></video>
      <video autoplay="" muted="" src="https://glpjt.s3.amazonaws.com/so/av/vs2s3.mp4"></video>
    </section>
   </article>
  </main>
  <footer class="display flex_center">
    <div>
     Fu Tip Estate
    </div>
    <div>
     富蝶邨
    </div>
  </footer>
  <script>
    function refreshTime() {
      var today = new Date(),
        day = today.getDay(),
        daylist = ["週日", "週一", "週二", "週三", "週四", "週五", "週六"],
        date = (today.getMonth() + 1) + '月' + today.getDate() + '日',
        time = (("0" + today.getHours()).slice(-2)) + ":" + (("0" + today.getMinutes()).slice(-2));
      
      $("#time").get(0).innerHTML = date + '<br>' + daylist[day] + '<br>' + time;
    }

    function display(time, timeout, target){
      $(target).get(0).style.display = "block";
      let cycles = setInterval(() => {
          var objects = $(target),
            now = objects.filter(":visible"),
            next = now.next().length ? now.next() : objects.first();

          now.fadeOut();
          next.fadeIn();
        }, time);
      
      if(timeout){
        setTimeout(() => {
          clearInterval(cycles);
        }, timeout-1);
      }
    }

    function cycleVT(time, timeout, target, videoNo) {
      var video = $("video").eq(videoNo);
      display(time, timeout, target);

      setTimeout(() => {
        $(target).filter(":visible").fadeOut();
        video.fadeIn();
        video.get(0).play();
        video.get(0).onended = function(){
          video.fadeOut();
          if(videoNo == $("video").length - 1){
            window.location = window.location.href;
          }
          cycleVT(time, timeout, target, videoNo + 1);
        };
      }, timeout);
    }

    var systemCycle = 3000,
      footerCycle = 3000,
      tableCycle = 1000,
      tablesTime = tableCycle * $("#tables > div").length;

    Promise.all($("video").map(function() {
      return new Promise(resolve => {
        $(this).one("loadedmetadata", resolve);
      });
    })).then(() => {
      display(systemCycle, 0, "#system > *");
      display(footerCycle, 0, "footer > div");

      refreshTime();
      setInterval(refreshTime, 1000);

      cycleVT(tableCycle, tablesTime, "#tables > div", 0)
    });
  </script>
 </body>
</html>
